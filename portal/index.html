<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>GMCA – Pay a Parking or Bus Lane Fine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- GOV.UK Frontend CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/govuk-frontend@4.13.0/dist/govuk-frontend-4.13.0.min.css">

  <!-- Custom styles -->
  <link rel="stylesheet" href="../start/style.css">
</head>

<body>
  <!-- Header -->
  <header class="gmca-header">
    <div class="gmca-header__container">
      <a href="https://www.greatermanchester-ca.gov.uk/" target="_blank" rel="noopener">
        <img src="https://eryripress.co.uk/icon3.svg" alt="GMCA logo" class="gmca-logo">
      </a>
    </div>
  </header>

  <!-- Search bar -->
  <div class="gmca-search-bar">
    <div class="gmca-search-container">
      <form id="gmca-search-form">
        <input id="gmca-search-input" type="text" placeholder="Search Greater Manchester Combined Authority...">
        <button type="submit">Search</button>
      </form>
    </div>
  </div>

  <!-- Breadcrumb -->
  <nav class="gmca-breadcrumb">
    <a href="https://www.greatermanchester-ca.gov.uk/">Home</a> ›
    <a href="/start/">Parking Fines</a> ›
    <span>Pay a Fine</span>
  </nav>

  <!-- Search redirect JS -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const searchForm = document.getElementById("gmca-search-form");
      const searchInput = document.getElementById("gmca-search-input");

      searchForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const query = encodeURIComponent(searchInput.value.trim());
        if (query) {
          window.location.href = `https://www.greatermanchester-ca.gov.uk/search?Query=${query}`;
        }
      });
    });
  </script>

  <!-- Main content -->
  <main class="govuk-width-container" id="main-content">
    <div class="lookup-card gmca-main">

      <h2 class="page-title">Penalty Charge Notice Portal</h2>
      <p class="page-subtitle">Enter your Penalty Charge Notice (PCN) number and vehicle registration.</p>

      <form id="pcn-form" novalidate>
        <!-- GOV.UK style error summary -->
        <div id="error-summary" class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary" style="display:none;">
          <h2 class="govuk-error-summary__title" id="error-summary-title">There is a problem</h2>
          <div class="govuk-error-summary__body">
            <ul id="error-list" class="govuk-list govuk-error-summary__list"></ul>
          </div>
        </div>

        <!-- PCN number -->
        <div class="form-group">
          <label for="PCN" class="form-label">PCN number</label>
          <div class="form-hint">Your PCN number starts with AW followed by 8 digits (example: AW12345678).</div>
          <input class="form-input govuk-input" id="PCN" name="PCN" type="text" maxlength="10" autocomplete="off" value="AW">
        </div>

        <!-- Registration number -->
        <div class="form-group">
          <label for="VRM" class="form-label">Vehicle registration number</label>
          <div class="form-hint">Enter your vehicle’s registration number (number plate).</div>
          <input class="form-input govuk-input" id="VRM" name="VRM" type="text" maxlength="24" autocomplete="off" required>
        </div>

        <button type="submit" class="govuk-button">Search</button>
      </form>

      <div class="bottom-text">
        <p>© Greater Manchester Combined Authority 2025</p>
        <p>
          <a href="https://www.greatermanchester-ca.gov.uk/who-we-are/accounts-transparency-and-governance/accessibility-statement/"
             target="_blank" rel="noopener noreferrer">
            Our accessibility statement
          </a>
        </p>
      </div>
    </div>
  </main>

  <!-- Form validation -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const form = document.getElementById("pcn-form");
      const errorSummary = document.getElementById("error-summary");
      const errorList = document.getElementById("error-list");

      form.addEventListener("submit", function(e) {
        e.preventDefault();

        const pcn = document.getElementById("PCN").value.trim().toUpperCase();
        const vrm = document.getElementById("VRM").value.trim().toUpperCase();

        let errors = [];

        // PCN validation
        if (pcn.length !== 10 || !pcn.startsWith("AW") || !/^[A-Z0-9]+$/.test(pcn)) {
          errors.push("Your PCN number must start with AW and be exactly 10 characters long.");
        }

        // VRM validation (required)
        if (!vrm) {
          errors.push("You must enter your vehicle registration number.");
        }

        if (errors.length > 0) {
          showErrors(errors);
          return;
        }

        // Redirect to payment page
        const payUrl = `/pay?pcn=${encodeURIComponent(pcn)}&vrm=${encodeURIComponent(vrm)}`;
        window.location.href = payUrl;
      });

      function showErrors(errors) {
        errorList.innerHTML = "";
        errors.forEach(msg => {
          const li = document.createElement("li");
          li.textContent = msg;
          errorList.appendChild(li);
        });

        errorSummary.style.display = "block";
        errorSummary.focus();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });
  </script>

  <!-- Footer -->
  <footer class="gmca-footer">
    <p>© Greater Manchester Combined Authority 2025</p>
  </footer>
</body>
</html>
